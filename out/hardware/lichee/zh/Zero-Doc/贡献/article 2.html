<!DOCTYPE html>
<html  class="md_page">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="">
    <meta name="description" content="[]">
    <meta name="generator" content="teedoc">
    <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        <link rel="stylesheet" href="/static/css/theme_default/prism.min.css" type="text/css"/>
        <link rel="stylesheet" href="/static/css/theme_default/dark.css" type="text/css"/>
        <link rel="stylesheet" href="/static/css/theme_default/light.css" type="text/css"/>
        <link rel="stylesheet" href="/static/css/custom.css" type="text/css"/>
        <script src="/static/js/theme_default/jquery.min.js"></script>
        <script src="/static/js/theme_default/pre_main.js"></script>
        <link rel="stylesheet" href="/static/css/search/style.css" type="text/css"/>
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?9cb07365544a53067c56c346c838181a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <title>Zero i2c oled使用指南 - Sipeed Wiki</title>
</head>
<body>
    
            <div id="navbar">
                <div id="navbar_menu">
                    <a class="site_title" href="/"><img class="site_logo" src="/static/image/logo.svg" alt="sipeed wiki logo"><h2>wiki</h2></a>
                    <a id="navbar_menu_btn"></a>
                </div>
                <div id="navbar_items">
                    <div>
                        <ul id="nav_left">
<li class=""><a  href="/">首页</a></li>
<li class=""><a target="_blank" href="https://www.sipeed.com">矽速官网</a></li>
<li class="sub_items "><a>开源软件</a><ul><li class=""><a  href="/soft/maixpy/zh/index.html">Maixpy</a></li>
<li class=""><a  href="/soft/maixpy3/zh/">Maixpy3</a></li>
<li class=""><a  href="/licheeos/zh/">Lichee OS</a></li>
<li class=""><a  href="/LonganOS/zh/">Longan OS</a></li>
<li class=""><a  href="/TangOs/zh/">Tang OS</a></li>
</ul>
</li>
<li class="sub_items active_parent"><a>开源硬件</a><ul><li class=""><a  href="/hardware/maix/zh/">Maix</a></li>
<li class=""><a  href="/hardware/maixII/zh/">Maix II</a></li>
<li class=""><a  href="/hardware/maixIII/zh/">Maix III</a></li>
<li class=""><a  href="/hardware/maixIV/zh/">Maix IV</a></li>
<li class="active"><a  href="/hardware/lichee/zh/">Lichee Pi</a></li>
<li class=""><a  href="/hardware/tang/zh/">Tang</a></li>
<li class=""><a  href="/hardware/longan/zh/">Longan</a></li>
</ul>
</li>
<li class="sub_items "><a>商业产品</a><ul><li class=""><a  href="/hardware/maixface/zh/">Maix Face</a></li>
</ul>
</li>
<li class="sub_items "><a>云平台</a><ul><li class=""><a target="_blank" href="https://www.maixhub.com">Maixhub 模型训练平台</a></li>
<li class=""><a target="_blank" href="https://www.maixhub.com/onlinecompiler">固件在线编译</a></li>
</ul>
</li>
<li class=""><a  href="/community.html">社区</a></li>
<li class=""><a  href="https://shop365481095.taobao.com/?spm=a230r.7195193.1997079397.2.8384341c2zZ5uZ">商城</a></li>
</ul>

                    </div>
                    <div>
                        <ul id="nav_right">
<li class="sub_items "><a  href="">Language: </a><ul><li class=""><a  href="/">中文</a></li>
<li class=""><a  href="/en/">English</a></li>
</ul></li>
</ul>

                        <ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">搜索</span>
                            <div id="search_hints">
                                <span id="search_input_hint">输入关键词，多关键词空格隔开</span>
                                <span id="search_loading_hint">正在加载，请稍候。。。</span>
                                <span id="search_download_err_hint">下载文件失败，请刷新重试或检查网络</span>
                                <span id="search_other_docs_result_hint">来自其它文档的结果</span>
                                <span id="search_curr_doc_result_hint">当前文档搜索结果</span>
                            </div></a></li></ul>
                    </div>
                </div>
            </div>
    
        <div id="wrapper">
            
            <div id="sidebar_wrapper">
                <div id="sidebar">
                    <div id="sidebar_title">
                        
                    </div>
                    <ul class="">
<li class="not_active no_link"><a><span class="label">LicheePi</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active no_link"><a><span class="label">简介</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active no_link"><a><span class="label">LicheePI Nano</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/index.html"><span class="label">简介</span><span class=""></span></a></li>
<li class="not_active no_link"><a><span class="label">上手体验</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/./Nano-Doc-Backup/get_started/first_eye.html"><span class="label">初见</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/get_started/first_eat.html"><span class="label">前言</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">系统适配篇</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/build_sys/build_index.html"><span class="label">总述</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/build_sys/onekey.html"><span class="label">镜像包一键烧录</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/build_sys/docker.html"><span class="label">docker快速搭建环境</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/build_sys/bootargs.html"><span class="label">uboot传递参数</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/build_sys/kernel.html"><span class="label">主线linux编译</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/build_sys/devicetree.html"><span class="label">设备树添加节点</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/build_sys/rootfs.html"><span class="label">根文件系统编译</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/build_sys/build_flash.html"><span class="label">SPI-Flash系统编译</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">驱动开发</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/driver/touchscreen.html"><span class="label">电容触摸屏适配</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">从挖坑到填坑</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/step_by_step/one_openbox.html"><span class="label">开箱介绍</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/step_by_step/two_sunxi-tools.html"><span class="label">编译使用sunxi-tools</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/step_by_step/three_uboot.html"><span class="label">编译使用uboot</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/step_by_step/four_linux.html"><span class="label">编译测试linux</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">应用开发</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/application/littlevgl.html"><span class="label">littlevGL的使用</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">奉献投稿</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/contribution/introduction.html"><span class="label">前言</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/contribution/todolist.html"><span class="label">Todolist</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/contribution/task_tips.html"><span class="label">快餐任务相关小事项</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/contribution/doc_tips.html"><span class="label">文档任务相关小事项</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Nano-Doc-Backup/contribution/build_doc.html"><span class="label">文档构建</span><span class=""></span></a></li>
</ul>
</li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">LicheePI Zero</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active no_link"><a><span class="label">初来乍到</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/Start/intro_cn.html"><span class="label">荔枝派与创作者的自我介绍</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/Start/tips.html"><span class="label">Linux使用小贴士</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/Start/board_intro.html"><span class="label">认识zero的硬件</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/Start/docker_index.html"><span class="label">Docker环境简明教程</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/Start/docker_env.html"><span class="label">Docker开发环境</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/Start/docker_command.html"><span class="label">Docker命令速查</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/Start/docker_ubuntu.html"><span class="label">基础ubuntu系统配置</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/System_Development/type.html"><span class="label">Zero的开发环境分类</span><span class=""></span></a></li>
<li class="not_active no_link"><a><span class="label">主线Uboot</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/System_Development/uboot_build.html"><span class="label">Uboot 编译</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/System_Development/uboot_conf.html"><span class="label">Uboot 配置</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/System_Development/uboot_logo.html"><span class="label">开机logo替换</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">主线Kernel</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/System_Development/kernel_build.html"><span class="label">主线Kernel基础编译</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/System_Development/kernel_printk.html"><span class="label">内核printk等级设置</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">BSP内核编译</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/System_Development/bsp_build.html"><span class="label">BSP源码下载与编译</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/System_Development/bsp_review.html"><span class="label"> BSP内核构建走读</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/System_Development/bsp_cam.html"><span class="label">BSP内核的摄像头使用</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/hardware/lichee/zh/Zero-Doc/System_Development/bsp_mem.html"><span class="label">bsp内核中的保留内存</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">根文件系统编译</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

                </div>
            </div>
            <div id="menu_wrapper">
                                    <div id="menu">
                                    </div>
                                </div>
            <div id="article">
                <div id="content_wrapper">
                    <div id="content_body">
                        <div id="article_head">
                            <div id="article_title">
                                <h1>Zero i2c oled使用指南</h1>
                            </div>
                            <div id="article_tags">
                                <ul></ul>
                            </div>
                            <div id="article_info">
                            <div>
                                <span class="article_author"></span><span class="article_date"></span>
                            </div>
                            <div>
                                
                            </div>
                            </div>
                        </div>
                        <div id="article_content">
                            <h1 id="1">1. 硬件连接</h1>

<p>一般市面上买到的单色oled屏幕模块一般都是同时支持spi和i2c接口的，而默认一般都是spi接口模式，需要根据说明书调整模模块上电阻的位置来转换到i2c模式。我手中这个模块一般比较常见，分辨率是128*64，需要焊接R1和R4，注意下方那个电阻位置要短接。</p>

<p><img src="https://box.kancloud.cn/b5224472a382d668d6cf0c12f0892538_739x557.jpg" alt="" /></p>

<p><img src="https://box.kancloud.cn/ce7036790bfaf95c2cf550c4bdac079b_833x431.jpg" alt="" /></p>

<p>然后连接到zero的i2c0的位置，reset引脚我连接到了uart2的tx脚位置。我手中暂时没有dock，如果是使用dock，请根据实际情况插到对应位置。</p>

<h1 id="2-ssd1307fb">2. ssd1307fb驱动配置</h1>

<p>Oled使用的控制芯片是<br />
ssd1306，最新版本的linux中包含Ssd1306的i2c驱动，驱动加载后会注册成功linux<br />
framebuffer，驱动文件路径是： <code>/drivers/video/fbdev/ssd1307fb.c</code><br />
，该驱动可以通过配置支持ssd130x系列芯片。</p>

<p>所以要使用oled只需要在dts配置好就可以了</p>

<p>进入linux目录调出配置菜单</p>

<p><strike>~~ {.sourceCode .bash}<br />
/linux-zero-4.10.y$ make ARCH=arm menuconfig<br />
~</strike>~</p>

<p>选中 \<*> Solomon SSD1307 framebuffer support</p>

<p><img src="https://box.kancloud.cn/aa91247dad30974e7c3058c7e5e28dea_850x391.jpg" alt="" /></p>

<p><img src="https://box.kancloud.cn/7d224ee935d3bd91da53556f8af4a5ed_918x404.jpg" alt="" /></p>

<p>修改dts资源文件</p>

<p><strike>~~ {.sourceCode .bash}<br />
vi arch/arm/boot/dts/sun8i-v3s-licheepi-zero.dts<br />
~</strike>~</p>

<p>添加 <code>ssd1306fb-i2c</code> 节点，<code>0x3c</code><br />
是i2c设备的地址，reset-getio是复位脚我选择的是*<em>PB0</em>*</p>

<p><img src="https://box.kancloud.cn/0f551b1cb47649be68f5dd5629a7ea90_755x450.jpg" alt="" /></p>

<p>接下来编译内核和编译dtb</p>

<p><strike>~~ {.sourceCode .bash}<br />
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j24 uImage<br />
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- dtbs<br />
~</strike>~</p>

<p>然后将内核和dtbs更新到zero上，插入串口上电。</p>

<p>我是将驱动直接编译到内核里，可以在内核日志中看到驱动加载成功。</p>

<p><img src="https://box.kancloud.cn/eafc995e356935d537d55d8599a5b62c_1512x268.jpg" alt="" /></p>

<p>并且屏幕被点亮，该驱动默认不清空屏幕ram中内容，屏幕初始化后默认是花屏内容是正常的。如下状态。</p>

<p><img src="https://box.kancloud.cn/c0bb555e7e7bfd8dc0a27cc56fc19514_630x545.jpg" alt="" /></p>

<p>驱动注册后一般会挂载为/dev/fb0或者/dev/fb1设备文件。</p>

<p>写一个简单的oled模块测试程序，读取屏幕信息，并刷将荔枝派logo显示上去效果如下：</p>

<p><img src="https://box.kancloud.cn/5331e69baa77045940264e9f4c7d70ca_760x586.jpg" alt="" /></p>

<p>首先用photoshop做出目标图片，然后保存成bmp格式，然后使用windows自带的画图工具打开bmp，然后点击另存为保存为1位位图格式。使用字模软件将bmp转换成程序用的字节序列，我用的是zimo221这款字模工具软件</p>

<p><img src="https://box.kancloud.cn/66d0a0ff9a97c502f5e989765e2b921f_1196x802.jpg" alt="" /></p>

<p>注意在参数设置中要勾选字节倒叙选项。</p>

<p>下面写一个测试程序，加载驱动并把图像显示到屏幕上</p>

<p>~~~~ {.sourceCode .c}</p>

<h1 id="include-unistdh">include <unistd.h></h1>

<h1 id="include-stdioh">include <stdio.h></h1>

<h1 id="include-fcntlh">include <fcntl.h></h1>

<h1 id="include-linuxfbh">include <linux/fb.h></h1>

<h1 id="include-sysmmanh">include <sys/mman.h></h1>

<h1 id="include-stdlibh">include <stdlib.h></h1>

<h1 id="include-stringh">include <string.h></h1>

<pre><code>/*seconds: the seconds; mseconds: the micro seconds*/
void setTimer(int seconds, int mseconds)
</code></pre>

<p>{<br />
    struct timeval temp;<br />
    temp.tv_sec = seconds;<br />
    temp.tv_usec = mseconds;<br />
    printf("timer1\n");<br />
    select(0, NULL, NULL, NULL, &amp;temp);<br />
    printf("timer2\n");<br />
    return ;<br />
}</p>

<p>int main ()<br />
{<br />
    char lichee[] = {<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0xE0,0x00,0x04,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x60,0x00,0x06,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x04,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xC0,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x07,0x3C,0x74,0xE0,0x81,0x03,0xE0,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x04,0x22,0x8C,0x10,0x43,0x04,0xF0,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x04,0x42,0x84,0x10,0x22,0x0C,0xF8,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x04,0x03,0x84,0x08,0x22,0x08,0xFC,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x04,0x01,0x84,0x18,0x22,0x08,0xFE,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x04,0x01,0x84,0x18,0x20,0x00,0xFE,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x00,0x04,0x01,0x84,0x08,0x20,0x00,0xFE,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,<br />
        0x40,0x10,0x04,0x03,0x84,0x18,0x20,0x00,0xFE,0xFF,0x00,0x00,0x00,0x00,0x00,0x08,<br />
        0x40,0x10,0x04,0x02,0x84,0x10,0x22,0x00,0xFF,0xFF,0x01,0x00,0x00,0x00,0x00,0x0C,<br />
        0x40,0x18,0x04,0x06,0x84,0x30,0x40,0x04,0xFF,0xFF,0x03,0x00,0x00,0x00,0x00,0x06,<br />
        0xE0,0x0F,0x1F,0x1C,0xCE,0xC1,0x80,0x03,0xFF,0xFF,0x07,0x00,0x00,0x00,0x00,0x07,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xFF,0xFF,0x0F,0x00,0x00,0x00,0x80,0x07,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xBF,0xFF,0x1F,0x00,0x00,0x00,0xC0,0x07,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xDF,0xFF,0x7F,0x00,0x00,0x00,0xE0,0x07,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC7,0xFF,0xFF,0x00,0x00,0x00,0xF0,0x03,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC9,0xFF,0xFF,0x01,0x00,0x00,0xF0,0x03,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0xC0,0xFF,0xFF,0x03,0x00,0x00,0xF8,0x03,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0xFF,0xFF,0x07,0x00,0x00,0xF0,0x03,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0xC0,0xF7,0xFF,0x0F,0x00,0x00,0xF8,0x03,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xE3,0xFF,0xFF,0x1F,0x00,0x00,0xF8,0x01,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xEF,0xFF,0xFF,0x7F,0x00,0x00,0xF8,0x01,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xFB,0xFF,0xFF,0xFF,0x00,0x00,0xFC,0x01,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xFF,0xFF,0xFF,0xFF,0x03,0x00,0xFC,0x00,<br />
        0x40,0x30,0x00,0x06,0x04,0x00,0x00,0x80,0xFF,0xFF,0xFF,0xFF,0x07,0x00,0xFE,0x00,<br />
        0x40,0x10,0x02,0x06,0x04,0xC0,0x00,0x9C,0xFF,0xFF,0xFF,0xFF,0x0F,0x00,0xFF,0x00,<br />
        0xFE,0xFF,0x07,0x06,0x04,0x80,0xC8,0x81,0xFF,0xFF,0xFF,0xFF,0x3F,0x00,0x7F,0x00,<br />
        0x40,0x10,0x00,0x06,0x04,0x80,0x08,0x00,0xFF,0xFF,0xFF,0xFF,0x7F,0x80,0x7F,0x00,<br />
        0x40,0x13,0x00,0x16,0xCC,0x00,0x08,0x10,0xFF,0xFF,0xFF,0xFF,0xFF,0xC0,0x7F,0x00,<br />
        0x00,0xC3,0xC0,0x3F,0x04,0x00,0x08,0x0E,0xFE,0xFF,0xFF,0xFF,0xFF,0xE3,0x3F,0x00,<br />
        0x00,0xC1,0x00,0x06,0x04,0x10,0x48,0x00,0xFE,0xFF,0xFF,0xFF,0xFF,0xF7,0x3F,0x00,<br />
        0x80,0x41,0x00,0x06,0x04,0x20,0x49,0x00,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0x3F,0x00,<br />
        0x80,0x40,0x00,0x0E,0x44,0x20,0x48,0x30,0xFC,0xFF,0xFF,0xFF,0xFF,0xFF,0x3F,0x00,<br />
        0x60,0x78,0x00,0x9F,0x61,0x80,0x48,0x08,0xF8,0xFF,0xFF,0xFF,0xFF,0xFF,0x3F,0x00,<br />
        0x38,0x30,0x00,0x17,0x60,0x80,0x48,0x02,0xF8,0xFF,0xFF,0xFF,0xFF,0xFF,0x3F,0x00,<br />
        0x20,0x60,0x00,0x17,0x21,0x80,0x48,0x02,0xF0,0xFF,0xFF,0xFF,0xFF,0xFF,0x1F,0x00,<br />
        0xFE,0xFB,0x83,0x06,0x30,0x40,0x48,0x02,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,0x1F,0x00,<br />
        0x30,0x23,0x02,0x06,0x12,0x70,0x44,0x04,0xC0,0xFF,0xFF,0xFF,0xFF,0xFF,0x0F,0x00,<br />
        0x30,0x23,0x42,0x06,0x1A,0x60,0x44,0x04,0x80,0xFF,0xFF,0xFF,0xFF,0xFF,0x07,0x00,<br />
        0x10,0x31,0x02,0x06,0x0C,0x40,0x44,0x08,0x80,0xFF,0xFF,0xFF,0xFF,0xFF,0x03,0x00,<br />
        0x18,0x11,0x03,0x06,0x0E,0x60,0x42,0x18,0xC0,0xFF,0xFF,0xFF,0xFF,0xFF,0x01,0x00,<br />
        0x88,0x19,0x03,0x06,0x31,0x60,0xC2,0x30,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,<br />
        0xC4,0xCD,0x01,0x86,0xE0,0x61,0x41,0x20,0xE0,0xFF,0xFF,0xFF,0xFF,0x7F,0x00,0x00,<br />
        0x00,0x82,0x01,0x36,0x80,0x00,0x00,0x00,0xF0,0xFF,0xFF,0xFF,0xFF,0x1F,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x9F,0xFF,0xFF,0xFF,0x07,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x0F,0xFF,0xFF,0xFF,0x01,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xFC,0xFF,0x7F,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0xFF,0x0F,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x7F,0x00,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x01,0x00,0x00,0x00,<br />
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00<br />
    };<br />
    int fp=0;<br />
    long screensize=0;</p>

<pre><code>char *fbp = 0;

struct fb_var_screeninfo vinfo;
struct fb_fix_screeninfo finfo;
fp = open ("/dev/fb1",O_RDWR);

if (fp &lt; 0){
    printf("Error : Can not open framebuffer device/n");
    exit(1);
}

if (ioctl(fp,FBIOGET_FSCREENINFO,&amp;finfo)){
    printf("Error reading fixed information/n");
    exit(2);
}

if (ioctl(fp,FBIOGET_VSCREENINFO,&amp;vinfo)){
    printf("Error reading variable information/n");
    exit(3);
}

printf("The mem is :%d\n",finfo.smem_len);
printf("The line_length is :%d\n",finfo.line_length);
printf("The xres is :%d\n",vinfo.xres);
printf("The yres is :%d\n",vinfo.yres);
printf("bits_per_pixel is :%d\n",vinfo.bits_per_pixel);

screensize = vinfo.xres * vinfo.yres * vinfo.bits_per_pixel / 8;
printf("screensize: %d\n",screensize);
fbp =(char *) mmap (0, screensize, PROT_READ | PROT_WRITE, MAP_SHARED,
    fp,0);
if ((int) fbp == -1)
{
    printf ("Error: failed to map framebuffer device to memory./n");
    exit (4);
}

int i=0;
memset(fbp, 0x00, 1024);
setTimer(3,0);
while(1){
    for(i=0;i&lt;1024;i++){
        fbp[i]=lichee[i];
    }
    setTimer(3,0);
    memset(fbp, 0x00, 1024);
    setTimer(3,0);
}
munmap (fbp, screensize);
close (fp);
</code></pre>

<p>}<br />
~~~~</p>

<p>将字节序在程序中定义为数组在荔枝板中，编译程序并执行。</p>

<p><img src="https://box.kancloud.cn/533e4d22e84e1eaa42218f37d0b43dbd_648x299.jpg" alt="" /></p>

<h1 id="3-i2c">3. 单片机驱动一直为i2c驱动</h1>

<p>一般情况下使用ssb1307fb这个驱动就很完美了了，我在发现ssd1307fb这个驱动程序之前，我将显示屏厂家提供的stm8<br />
i2c测试代码移植到了linux上实现了一个驱动，加载驱动后效果如下</p>

<p><img src="https://box.kancloud.cn/0bff0424a51d86f32442b91c374174d1_703x631.jpg" alt="" /></p>

<p>我将此驱动也发出来供参考，该驱动程序直接在linux<br />
i2c设备注册中实现了oled的测试显示，该驱动包含一个基本ascii的字库和字符串显示逻辑。</p>

<p>~~~~ {.sourceCode .c}</p>

<h1 id="include-linuxkernelh">include <linux/kernel.h></h1>

<h1 id="include-linuxinith">include <linux/init.h></h1>

<h1 id="include-linuxmoduleh">include <linux/module.h></h1>

<h1 id="include-linuxslabh">include <linux/slab.h></h1>

<h1 id="include-linuxjiffiesh">include <linux/jiffies.h></h1>

<h1 id="include-linuxi2ch">include <linux/i2c.h></h1>

<h1 id="include-linuxmutexh">include <linux/mutex.h></h1>

<h1 id="include-linuxfsh">include <linux/fs.h></h1>

<h1 id="include-asmuaccessh">include <asm/uaccess.h></h1>

<h1 id="define-ssd1306_cmd-0">define SSD1306_CMD    0</h1>

<h1 id="define-ssd1306_dat-1">define SSD1306_DAT    1</h1>

<h1 id="define-ssd1306_width-128">define SSD1306_WIDTH    128</h1>

<h1 id="define-ssd1306_height-64">define SSD1306_HEIGHT  64</h1>

<h1 id="define-ssd1306_ts_name-ssd1306_ts">define SSD1306_TS_NAME "ssd1306_ts"</h1>

<p>static uint8_t s_chDispalyBuffer[128][8];</p>

<p>const uint8_t c_chFont1608[95][16] = {<br />
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/<em>" ",0</em>/<br />
{0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xCC,0x00,0x0C,0x00,0x00,0x00,0x00,0x00,0x00},/<em>"!",1</em>/<br />
{0x00,0x00,0x08,0x00,0x30,0x00,0x60,0x00,0x08,0x00,0x30,0x00,0x60,0x00,0x00,0x00},/<em>""",2</em>/<br />
{0x02,0x20,0x03,0xFC,0x1E,0x20,0x02,0x20,0x03,0xFC,0x1E,0x20,0x02,0x20,0x00,0x00},/<em>"#",3</em>/<br />
{0x00,0x00,0x0E,0x18,0x11,0x04,0x3F,0xFF,0x10,0x84,0x0C,0x78,0x00,0x00,0x00,0x00},/<em>"$",4</em>/<br />
{0x0F,0x00,0x10,0x84,0x0F,0x38,0x00,0xC0,0x07,0x78,0x18,0x84,0x00,0x78,0x00,0x00},/<em>"%",5</em>/<br />
{0x00,0x78,0x0F,0x84,0x10,0xC4,0x11,0x24,0x0E,0x98,0x00,0xE4,0x00,0x84,0x00,0x08},/<em>"&amp;",6</em>/<br />
{0x08,0x00,0x68,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/<em>"'",7</em>/<br />
{0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xE0,0x18,0x18,0x20,0x04,0x40,0x02,0x00,0x00},/<em>"(",8</em>/<br />
{0x00,0x00,0x40,0x02,0x20,0x04,0x18,0x18,0x07,0xE0,0x00,0x00,0x00,0x00,0x00,0x00},/<em>")",9</em>/<br />
{0x02,0x40,0x02,0x40,0x01,0x80,0x0F,0xF0,0x01,0x80,0x02,0x40,0x02,0x40,0x00,0x00},/<em>"</em>",10<em>/<br />
{0x00,0x80,0x00,0x80,0x00,0x80,0x0F,0xF8,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x00},/</em>"+",11<em>/<br />
{0x00,0x01,0x00,0x0D,0x00,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/</em>",",12<em>/<br />
{0x00,0x00,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80},/</em>"-",13<em>/<br />
{0x00,0x00,0x00,0x0C,0x00,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/</em>".",14<em>/<br />
{0x00,0x00,0x00,0x06,0x00,0x18,0x00,0x60,0x01,0x80,0x06,0x00,0x18,0x00,0x20,0x00},/</em>"/",15<em>/<br />
{0x00,0x00,0x07,0xF0,0x08,0x08,0x10,0x04,0x10,0x04,0x08,0x08,0x07,0xF0,0x00,0x00},/</em>"0",16<em>/<br />
{0x00,0x00,0x08,0x04,0x08,0x04,0x1F,0xFC,0x00,0x04,0x00,0x04,0x00,0x00,0x00,0x00},/</em>"1",17<em>/<br />
{0x00,0x00,0x0E,0x0C,0x10,0x14,0x10,0x24,0x10,0x44,0x11,0x84,0x0E,0x0C,0x00,0x00},/</em>"2",18<em>/<br />
{0x00,0x00,0x0C,0x18,0x10,0x04,0x11,0x04,0x11,0x04,0x12,0x88,0x0C,0x70,0x00,0x00},/</em>"3",19<em>/<br />
{0x00,0x00,0x00,0xE0,0x03,0x20,0x04,0x24,0x08,0x24,0x1F,0xFC,0x00,0x24,0x00,0x00},/</em>"4",20<em>/<br />
{0x00,0x00,0x1F,0x98,0x10,0x84,0x11,0x04,0x11,0x04,0x10,0x88,0x10,0x70,0x00,0x00},/</em>"5",21<em>/<br />
{0x00,0x00,0x07,0xF0,0x08,0x88,0x11,0x04,0x11,0x04,0x18,0x88,0x00,0x70,0x00,0x00},/</em>"6",22<em>/<br />
{0x00,0x00,0x1C,0x00,0x10,0x00,0x10,0xFC,0x13,0x00,0x1C,0x00,0x10,0x00,0x00,0x00},/</em>"7",23<em>/<br />
{0x00,0x00,0x0E,0x38,0x11,0x44,0x10,0x84,0x10,0x84,0x11,0x44,0x0E,0x38,0x00,0x00},/</em>"8",24<em>/<br />
{0x00,0x00,0x07,0x00,0x08,0x8C,0x10,0x44,0x10,0x44,0x08,0x88,0x07,0xF0,0x00,0x00},/</em>"9",25<em>/<br />
{0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x0C,0x03,0x0C,0x00,0x00,0x00,0x00,0x00,0x00},/</em>":",26<em>/<br />
{0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/</em>";",27<em>/<br />
{0x00,0x00,0x00,0x80,0x01,0x40,0x02,0x20,0x04,0x10,0x08,0x08,0x10,0x04,0x00,0x00},/</em>"&lt;",28<em>/<br />
{0x02,0x20,0x02,0x20,0x02,0x20,0x02,0x20,0x02,0x20,0x02,0x20,0x02,0x20,0x00,0x00},/</em>"=",29<em>/<br />
{0x00,0x00,0x10,0x04,0x08,0x08,0x04,0x10,0x02,0x20,0x01,0x40,0x00,0x80,0x00,0x00},/</em>">",30<em>/<br />
{0x00,0x00,0x0E,0x00,0x12,0x00,0x10,0x0C,0x10,0x6C,0x10,0x80,0x0F,0x00,0x00,0x00},/</em>"?",31<em>/<br />
{0x03,0xE0,0x0C,0x18,0x13,0xE4,0x14,0x24,0x17,0xC4,0x08,0x28,0x07,0xD0,0x00,0x00},/</em>"@",32<em>/<br />
{0x00,0x04,0x00,0x3C,0x03,0xC4,0x1C,0x40,0x07,0x40,0x00,0xE4,0x00,0x1C,0x00,0x04},/</em>"A",33<em>/<br />
{0x10,0x04,0x1F,0xFC,0x11,0x04,0x11,0x04,0x11,0x04,0x0E,0x88,0x00,0x70,0x00,0x00},/</em>"B",34<em>/<br />
{0x03,0xE0,0x0C,0x18,0x10,0x04,0x10,0x04,0x10,0x04,0x10,0x08,0x1C,0x10,0x00,0x00},/</em>"C",35<em>/<br />
{0x10,0x04,0x1F,0xFC,0x10,0x04,0x10,0x04,0x10,0x04,0x08,0x08,0x07,0xF0,0x00,0x00},/</em>"D",36<em>/<br />
{0x10,0x04,0x1F,0xFC,0x11,0x04,0x11,0x04,0x17,0xC4,0x10,0x04,0x08,0x18,0x00,0x00},/</em>"E",37<em>/<br />
{0x10,0x04,0x1F,0xFC,0x11,0x04,0x11,0x00,0x17,0xC0,0x10,0x00,0x08,0x00,0x00,0x00},/</em>"F",38<em>/<br />
{0x03,0xE0,0x0C,0x18,0x10,0x04,0x10,0x04,0x10,0x44,0x1C,0x78,0x00,0x40,0x00,0x00},/</em>"G",39<em>/<br />
{0x10,0x04,0x1F,0xFC,0x10,0x84,0x00,0x80,0x00,0x80,0x10,0x84,0x1F,0xFC,0x10,0x04},/</em>"H",40<em>/<br />
{0x00,0x00,0x10,0x04,0x10,0x04,0x1F,0xFC,0x10,0x04,0x10,0x04,0x00,0x00,0x00,0x00},/</em>"I",41<em>/<br />
{0x00,0x03,0x00,0x01,0x10,0x01,0x10,0x01,0x1F,0xFE,0x10,0x00,0x10,0x00,0x00,0x00},/</em>"J",42<em>/<br />
{0x10,0x04,0x1F,0xFC,0x11,0x04,0x03,0x80,0x14,0x64,0x18,0x1C,0x10,0x04,0x00,0x00},/</em>"K",43<em>/<br />
{0x10,0x04,0x1F,0xFC,0x10,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x0C,0x00,0x00},/</em>"L",44<em>/<br />
{0x10,0x04,0x1F,0xFC,0x1F,0x00,0x00,0xFC,0x1F,0x00,0x1F,0xFC,0x10,0x04,0x00,0x00},/</em>"M",45<em>/<br />
{0x10,0x04,0x1F,0xFC,0x0C,0x04,0x03,0x00,0x00,0xE0,0x10,0x18,0x1F,0xFC,0x10,0x00},/</em>"N",46<em>/<br />
{0x07,0xF0,0x08,0x08,0x10,0x04,0x10,0x04,0x10,0x04,0x08,0x08,0x07,0xF0,0x00,0x00},/</em>"O",47<em>/<br />
{0x10,0x04,0x1F,0xFC,0x10,0x84,0x10,0x80,0x10,0x80,0x10,0x80,0x0F,0x00,0x00,0x00},/</em>"P",48<em>/<br />
{0x07,0xF0,0x08,0x18,0x10,0x24,0x10,0x24,0x10,0x1C,0x08,0x0A,0x07,0xF2,0x00,0x00},/</em>"Q",49<em>/<br />
{0x10,0x04,0x1F,0xFC,0x11,0x04,0x11,0x00,0x11,0xC0,0x11,0x30,0x0E,0x0C,0x00,0x04},/</em>"R",50<em>/<br />
{0x00,0x00,0x0E,0x1C,0x11,0x04,0x10,0x84,0x10,0x84,0x10,0x44,0x1C,0x38,0x00,0x00},/</em>"S",51<em>/<br />
{0x18,0x00,0x10,0x00,0x10,0x04,0x1F,0xFC,0x10,0x04,0x10,0x00,0x18,0x00,0x00,0x00},/</em>"T",52<em>/<br />
{0x10,0x00,0x1F,0xF8,0x10,0x04,0x00,0x04,0x00,0x04,0x10,0x04,0x1F,0xF8,0x10,0x00},/</em>"U",53<em>/<br />
{0x10,0x00,0x1E,0x00,0x11,0xE0,0x00,0x1C,0x00,0x70,0x13,0x80,0x1C,0x00,0x10,0x00},/</em>"V",54<em>/<br />
{0x1F,0xC0,0x10,0x3C,0x00,0xE0,0x1F,0x00,0x00,0xE0,0x10,0x3C,0x1F,0xC0,0x00,0x00},/</em>"W",55<em>/<br />
{0x10,0x04,0x18,0x0C,0x16,0x34,0x01,0xC0,0x01,0xC0,0x16,0x34,0x18,0x0C,0x10,0x04},/</em>"X",56<em>/<br />
{0x10,0x00,0x1C,0x00,0x13,0x04,0x00,0xFC,0x13,0x04,0x1C,0x00,0x10,0x00,0x00,0x00},/</em>"Y",57<em>/<br />
{0x08,0x04,0x10,0x1C,0x10,0x64,0x10,0x84,0x13,0x04,0x1C,0x04,0x10,0x18,0x00,0x00},/</em>"Z",58<em>/<br />
{0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xFE,0x40,0x02,0x40,0x02,0x40,0x02,0x00,0x00},/</em>"[",59<em>/<br />
{0x00,0x00,0x30,0x00,0x0C,0x00,0x03,0x80,0x00,0x60,0x00,0x1C,0x00,0x03,0x00,0x00},/</em>"\",60<em>/<br />
{0x00,0x00,0x40,0x02,0x40,0x02,0x40,0x02,0x7F,0xFE,0x00,0x00,0x00,0x00,0x00,0x00},/</em>"]",61<em>/<br />
{0x00,0x00,0x00,0x00,0x20,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x20,0x00,0x00,0x00},/</em>"^",62<em>/<br />
{0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01},/</em>"_",63<em>/<br />
{0x00,0x00,0x40,0x00,0x40,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/</em>"`",64<em>/<br />
{0x00,0x00,0x00,0x98,0x01,0x24,0x01,0x44,0x01,0x44,0x01,0x44,0x00,0xFC,0x00,0x04},/</em>"a",65<em>/<br />
{0x10,0x00,0x1F,0xFC,0x00,0x88,0x01,0x04,0x01,0x04,0x00,0x88,0x00,0x70,0x00,0x00},/</em>"b",66<em>/<br />
{0x00,0x00,0x00,0x70,0x00,0x88,0x01,0x04,0x01,0x04,0x01,0x04,0x00,0x88,0x00,0x00},/</em>"c",67<em>/<br />
{0x00,0x00,0x00,0x70,0x00,0x88,0x01,0x04,0x01,0x04,0x11,0x08,0x1F,0xFC,0x00,0x04},/</em>"d",68<em>/<br />
{0x00,0x00,0x00,0xF8,0x01,0x44,0x01,0x44,0x01,0x44,0x01,0x44,0x00,0xC8,0x00,0x00},/</em>"e",69<em>/<br />
{0x00,0x00,0x01,0x04,0x01,0x04,0x0F,0xFC,0x11,0x04,0x11,0x04,0x11,0x00,0x18,0x00},/</em>"f",70<em>/<br />
{0x00,0x00,0x00,0xD6,0x01,0x29,0x01,0x29,0x01,0x29,0x01,0xC9,0x01,0x06,0x00,0x00},/</em>"g",71<em>/<br />
{0x10,0x04,0x1F,0xFC,0x00,0x84,0x01,0x00,0x01,0x00,0x01,0x04,0x00,0xFC,0x00,0x04},/</em>"h",72<em>/<br />
{0x00,0x00,0x01,0x04,0x19,0x04,0x19,0xFC,0x00,0x04,0x00,0x04,0x00,0x00,0x00,0x00},/</em>"i",73<em>/<br />
{0x00,0x00,0x00,0x03,0x00,0x01,0x01,0x01,0x19,0x01,0x19,0xFE,0x00,0x00,0x00,0x00},/</em>"j",74<em>/<br />
{0x10,0x04,0x1F,0xFC,0x00,0x24,0x00,0x40,0x01,0xB4,0x01,0x0C,0x01,0x04,0x00,0x00},/</em>"k",75<em>/<br />
{0x00,0x00,0x10,0x04,0x10,0x04,0x1F,0xFC,0x00,0x04,0x00,0x04,0x00,0x00,0x00,0x00},/</em>"l",76<em>/<br />
{0x01,0x04,0x01,0xFC,0x01,0x04,0x01,0x00,0x01,0xFC,0x01,0x04,0x01,0x00,0x00,0xFC},/</em>"m",77<em>/<br />
{0x01,0x04,0x01,0xFC,0x00,0x84,0x01,0x00,0x01,0x00,0x01,0x04,0x00,0xFC,0x00,0x04},/</em>"n",78<em>/<br />
{0x00,0x00,0x00,0xF8,0x01,0x04,0x01,0x04,0x01,0x04,0x01,0x04,0x00,0xF8,0x00,0x00},/</em>"o",79<em>/<br />
{0x01,0x01,0x01,0xFF,0x00,0x85,0x01,0x04,0x01,0x04,0x00,0x88,0x00,0x70,0x00,0x00},/</em>"p",80<em>/<br />
{0x00,0x00,0x00,0x70,0x00,0x88,0x01,0x04,0x01,0x04,0x01,0x05,0x01,0xFF,0x00,0x01},/</em>"q",81<em>/<br />
{0x01,0x04,0x01,0x04,0x01,0xFC,0x00,0x84,0x01,0x04,0x01,0x00,0x01,0x80,0x00,0x00},/</em>"r",82<em>/<br />
{0x00,0x00,0x00,0xCC,0x01,0x24,0x01,0x24,0x01,0x24,0x01,0x24,0x01,0x98,0x00,0x00},/</em>"s",83<em>/<br />
{0x00,0x00,0x01,0x00,0x01,0x00,0x07,0xF8,0x01,0x04,0x01,0x04,0x00,0x00,0x00,0x00},/</em>"t",84<em>/<br />
{0x01,0x00,0x01,0xF8,0x00,0x04,0x00,0x04,0x00,0x04,0x01,0x08,0x01,0xFC,0x00,0x04},/</em>"u",85<em>/<br />
{0x01,0x00,0x01,0x80,0x01,0x70,0x00,0x0C,0x00,0x10,0x01,0x60,0x01,0x80,0x01,0x00},/</em>"v",86<em>/<br />
{0x01,0xF0,0x01,0x0C,0x00,0x30,0x01,0xC0,0x00,0x30,0x01,0x0C,0x01,0xF0,0x01,0x00},/</em>"w",87<em>/<br />
{0x00,0x00,0x01,0x04,0x01,0x8C,0x00,0x74,0x01,0x70,0x01,0x8C,0x01,0x04,0x00,0x00},/</em>"x",88<em>/<br />
{0x01,0x01,0x01,0x81,0x01,0x71,0x00,0x0E,0x00,0x18,0x01,0x60,0x01,0x80,0x01,0x00},/</em>"y",89<em>/<br />
{0x00,0x00,0x01,0x84,0x01,0x0C,0x01,0x34,0x01,0x44,0x01,0x84,0x01,0x0C,0x00,0x00},/</em>"z",90<em>/<br />
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x3E,0xFC,0x40,0x02,0x40,0x02},/</em>"{",91<em>/<br />
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00},/</em>"|",92<em>/<br />
{0x00,0x00,0x40,0x02,0x40,0x02,0x3E,0xFC,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/</em>"}",93<em>/<br />
{0x00,0x00,0x60,0x00,0x80,0x00,0x80,0x00,0x40,0x00,0x40,0x00,0x20,0x00,0x20,0x00},/</em>"~",94*/<br />
};</p>

<p>struct i2c_client *ssd1306_client;</p>

<p>static void ssd1306_write_byte(uint8_t chData, uint8_t chCmd)<br />
{<br />
    uint8_t cmd = 0x00;</p>

<pre><code>if (chCmd) {
    cmd = 0x40;
} else {
    cmd = 0x00;
}

i2c_smbus_write_byte_data(ssd1306_client, cmd, chData);
</code></pre>

<p>}</p>

<p>void ssd1306_display_on(void)<br />
{<br />
    ssd1306_write_byte(0x8D, SSD1306_CMD);<br />
    ssd1306_write_byte(0x14, SSD1306_CMD);<br />
    ssd1306_write_byte(0xAF, SSD1306_CMD);<br />
}</p>

<p>/**</p>

<ul>
<li>@brief  OLED turns off<br />
*</li>
<li>@param  None<br />
*</li>
<li>@retval  None<br />
**/<br />
void ssd1306_display_off(void)<br />
{<br />
ssd1306_write_byte(0x8D, SSD1306_CMD);<br />
ssd1306_write_byte(0x10, SSD1306_CMD);<br />
ssd1306_write_byte(0xAE, SSD1306_CMD);<br />
}</li>
</ul>

<p>void ssd1306_refresh_gram(void)<br />
{<br />
    uint8_t i, j;</p>

<pre><code>for (i = 0; i &lt; 8; i ++) {
    ssd1306_write_byte(0xB0 + i, SSD1306_CMD);
    ssd1306_write_byte(0x02, SSD1306_CMD);
    ssd1306_write_byte(0x10, SSD1306_CMD);
    for (j = 0; j &lt; 128; j ++) {
        ssd1306_write_byte(s_chDispalyBuffer[j][i], SSD1306_DAT);
    }
}
</code></pre>

<p>}</p>

<p>void ssd1306_clear_screen(uint8_t chFill)<br />
{<br />
    memset(s_chDispalyBuffer,chFill, sizeof(s_chDispalyBuffer));<br />
    ssd1306_refresh_gram();<br />
}</p>

<p>/**</p>

<ul>
<li>@brief  Draws a piont on the screen<br />
*</li>
<li>@param  chXpos: Specifies the X position</li>
<li>@param  chYpos: Specifies the Y position</li>
<li>@param  chPoint: 0: the point turns off    1: the piont turns on<br />
*</li>
<li>@retval None<br />
**/</li>
</ul>

<p>void ssd1306_draw_point(uint8_t chXpos, uint8_t chYpos, uint8_t chPoint)<br />
{<br />
    uint8_t chPos, chBx, chTemp = 0;</p>

<pre><code>if (chXpos &gt; 127 || chYpos &gt; 63) {
    return;
}
chPos = 7 - chYpos / 8; //
chBx = chYpos % 8;
chTemp = 1 &lt;&lt; (7 - chBx);

if (chPoint) {
    s_chDispalyBuffer[chXpos][chPos] |= chTemp;

} else {
    s_chDispalyBuffer[chXpos][chPos] &amp;= ~chTemp;
}
</code></pre>

<p>}</p>

<p>/**</p>

<ul>
<li>@brief  Fills a rectangle<br />
*</li>
<li>@param  chXpos1: Specifies the X position 1 (X top left position)</li>
<li>@param  chYpos1: Specifies the Y position 1 (Y top left position)</li>
<li>@param  chXpos2: Specifies the X position 2 (X bottom right position)</li>
<li>@param  chYpos3: Specifies the Y position 2 (Y bottom right position)<br />
*</li>
<li>@retval<br />
**/</li>
</ul>

<p>void ssd1306_fill_screen(uint8_t chXpos1, uint8_t chYpos1, uint8_t chXpos2, uint8_t chYpos2, uint8_t chDot)<br />
{<br />
    uint8_t chXpos, chYpos;</p>

<pre><code>for (chXpos = chXpos1; chXpos &lt;= chXpos2; chXpos ++) {
    for (chYpos = chYpos1; chYpos &lt;= chYpos2; chYpos ++) {
        ssd1306_draw_point(chXpos, chYpos, chDot);
    }
}

ssd1306_refresh_gram();
</code></pre>

<p>}</p>

<p>/**</p>

<ul>
<li>@brief Displays one character at the specified position<br />
*</li>
<li>@param  chXpos: Specifies the X position</li>
<li>@param  chYpos: Specifies the Y position</li>
<li>@param  chSize:</li>
<li>@param  chMode</li>
<li>@retval<br />
**/<br />
void ssd1306_display_char(uint8_t chXpos, uint8_t chYpos, uint8_t chChr, uint8_t chSize, uint8_t chMode)<br />
{<br />
uint8_t i, j;<br />
uint8_t chTemp, chYpos0 = chYpos;</li>
</ul>

<pre><code>chChr = chChr - ' ';
for (i = 0; i &lt; chSize; i ++) {
    if (chMode) {
        chTemp = c_chFont1608[chChr][i];
    } else {
        chTemp = ~c_chFont1608[chChr][i];
    }

    for (j = 0; j &lt; 8; j ++) {
        if (chTemp &amp; 0x80) {
            ssd1306_draw_point(chXpos, chYpos, 1);
        } else {
            ssd1306_draw_point(chXpos, chYpos, 0);
        }
        chTemp &lt;&lt;= 1;
        chYpos ++;

        if ((chYpos - chYpos0) == chSize) {
            chYpos = chYpos0;
            chXpos ++;
            break;
        }
    }
}
</code></pre>

<p>}</p>

<p>/**</p>

<ul>
<li>@brief  Displays a string on the screen<br />
*</li>
<li>@param  chXpos: Specifies the X position</li>
<li>@param  chYpos: Specifies the Y position</li>
<li>@param  pchString: Pointer to a string to display on the screen<br />
*</li>
<li>@retval  None<br />
**/<br />
void ssd1306_display_string(uint8_t chXpos, uint8_t chYpos, const uint8_t *pchString, uint8_t chSize, uint8_t chMode)<br />
{</li>
</ul>

<p>printk("%s, ssd1306 str = %s\n", __func__, pchString);<br />
    while (*pchString != '\0') {<br />
        if (chXpos &gt; (SSD1306_WIDTH - chSize / 2)) {<br />
            chXpos = 0;<br />
            chYpos += chSize;<br />
            if (chYpos &gt; (SSD1306_HEIGHT - chSize)) {<br />
                chYpos = chXpos = 0;<br />
                ssd1306_clear_screen(0x00);<br />
            }<br />
        }</p>

<pre><code>    ssd1306_display_char(chXpos, chYpos, *pchString, chSize, chMode);
    chXpos += chSize / 2;
    pchString ++;
}
</code></pre>

<p>}</p>

<p>void ssd1306_init(void)<br />
{<br />
    ssd1306_write_byte(0xAE, SSD1306_CMD);//--turn off oled panel<br />
    ssd1306_write_byte(0x00, SSD1306_CMD);//---set low column address<br />
    ssd1306_write_byte(0x10, SSD1306_CMD);//---set high column address<br />
    ssd1306_write_byte(0x40, SSD1306_CMD);//--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)<br />
    ssd1306_write_byte(0x81, SSD1306_CMD);//--set contrast control register<br />
    ssd1306_write_byte(0xCF, SSD1306_CMD);// Set SEG Output Current Brightness<br />
    ssd1306_write_byte(0xA1, SSD1306_CMD);//--Set SEG/Column Mapping<br />
    ssd1306_write_byte(0xC0, SSD1306_CMD);//Set COM/Row Scan Direction<br />
    ssd1306_write_byte(0xA6, SSD1306_CMD);//--set normal display<br />
    ssd1306_write_byte(0xA8, SSD1306_CMD);//--set multiplex ratio(1 to 64)<br />
    ssd1306_write_byte(0x3f, SSD1306_CMD);//--1/64 duty<br />
    ssd1306_write_byte(0xD3, SSD1306_CMD);//-set display offset    Shift Mapping RAM Counter (0x00~0x3F)<br />
    ssd1306_write_byte(0x00, SSD1306_CMD);//-not offset<br />
    ssd1306_write_byte(0xd5, SSD1306_CMD);//--set display clock divide ratio/oscillator frequency<br />
    ssd1306_write_byte(0x80, SSD1306_CMD);//--set divide ratio, Set Clock as 100 Frames/Sec<br />
    ssd1306_write_byte(0xD9, SSD1306_CMD);//--set pre-charge period<br />
    ssd1306_write_byte(0xF1, SSD1306_CMD);//Set Pre-Charge as 15 Clocks &amp; Discharge as 1 Clock<br />
    ssd1306_write_byte(0xDA, SSD1306_CMD);//--set com pins hardware configuration<br />
    ssd1306_write_byte(0x12, SSD1306_CMD);<br />
    ssd1306_write_byte(0xDB, SSD1306_CMD);//--set vcomh<br />
    ssd1306_write_byte(0x40, SSD1306_CMD);//Set VCOM Deselect Level<br />
    ssd1306_write_byte(0x20, SSD1306_CMD);//-Set Page Addressing Mode (0x00/0x01/0x02)<br />
    ssd1306_write_byte(0x02, SSD1306_CMD);//<br />
    ssd1306_write_byte(0x8D, SSD1306_CMD);//--set Charge Pump enable/disable<br />
    ssd1306_write_byte(0x14, SSD1306_CMD);//--set(0x10) disable<br />
    ssd1306_write_byte(0xA4, SSD1306_CMD);// Disable Entire Display On (0xa4/0xa5)<br />
    ssd1306_write_byte(0xA6, SSD1306_CMD);// Disable Inverse Display On (0xa6/a7)<br />
    ssd1306_write_byte(0xAF, SSD1306_CMD);//--turn on oled panel</p>

<pre><code>ssd1306_display_on();
ssd1306_clear_screen(0xff);
</code></pre>

<p>}</p>

<p>static int ssd1306_ts_probe(struct i2c_client *client,<br />
                           const struct i2c_device_id *id)<br />
{</p>

<p>printk("ssd1306_ts_probe\n");<br />
 printk("probe %s\n",__func__);<br />
printk("%s, addr = %x, line = %d\n", __func__, client->addr, client->adapter->nr);</p>

<p>printk("%s, name = %s, adapter nr = %d\n", __func__, client->adapter->name, client->adapter->nr);</p>

<pre><code>ssd1306_client = client;

    ssd1306_init();

    ssd1306_clear_screen(0x00);
//ssd1306_display_off();
</code></pre>

<p>ssd1306_display_on();<br />
    ssd1306_display_string(18, 0, "Welcome!", 16, 1);<br />
    ssd1306_display_string(0, 16, "zero i2c driver", 16, 1);<br />
    ssd1306_refresh_gram();<br />
   // ssd1306_display_on();</p>

<pre><code>    return 0;
</code></pre>

<p>};</p>

<p>static const struct i2c_device_id ssd1306_ts_id[] = {<br />
        { "ssd1306", 0 },<br />
        { }<br />
};<br />
MODULE_DEVICE_TABLE(i2c, ssd1306_ts_id);</p>

<p>static struct i2c_driver ssd1306_ts_driver = {<br />
        .probe = ssd1306_ts_probe,<br />
        .id_table = ssd1306_ts_id,<br />
        .driver = {<br />
                .name = SSD1306_TS_NAME,<br />
        },<br />
};<br />
module_i2c_driver(ssd1306_ts_driver);<br />
MODULE_LICENSE("GPL");<br />
~~~~</p>

<p>相应dts配置如下：</p>

<p><img src="https://box.kancloud.cn/9a68c7be1bf1c3b3b9b9809cf18c156c_537x310.jpg" alt="" /></p>

                        </div>
                    </div>
                    <div id="previous_next">
                        <div id="previous">
                            
                        </div>
                        <div id="next">
                            
                        </div>
                    </div>
                </div>
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
        <a id="to_top" href="#"></a>
        <div id="doc_footer">
                        
            <div id="footer">
                <div id="footer_top">
                    <ul>
<li><a>链接</a><ul><li><a target="_blank" href="https://www.sipeed.com">Sipeed</a></li>
<li><a target="_blank" href="https://bbs.sipeed.com/">BBS 论坛</a></li>
<li><a target="_blank" href="https://maixhub.sipeed.com/">Maixhub</a></li>
<li><a target="_blank" href="https://sipeed.taobao.com/">Sipeed 淘宝</a></li>
<li><a target="_blank" href="https://github.com/neutree/teedoc">使用 teedoc 构建</a></li>
</ul>
</li>
<li><a>网站统计</a><ul><li><a target="_blank" href="https://tongji.baidu.com/web/welcome/ico?s=9cb07365544a53067c56c346c838181a">百度统计</a></li>
<li><a  href="/sitemap.xml">网站地图</a></li>
</ul>
</li>
<li><a>源码</a><ul><li><a target="_blank" href="https://github.com/sipeed/sipeed_wiki">文档源文件</a></li>
<li><a target="_blank" href="https://github.com/sipeed">开源项目源码</a></li>
</ul>
</li>
<li><a>关注我们</a><ul><li><a target="_blank" href="https://github.com/sipeed">github</a></li>
<li><a target="_blank" href="https://twitter.com/SipeedIO">twitter</a></li>
<li><a target="_blank" href="https://sipeed.taobao.com/">淘宝</a></li>
<li><a  href="/social_group.html">更多</a></li>
</ul>
</li>
<li><a>联系我们</a><ul><li><a>电话: +86 0755-27808509</a>
</li>
<li><a>商业支持: support@sipeed.com</a>
</li>
<li><a>地址: 深圳市宝安区新湖路华美居B区1号楼713-715</a>
</li>
<li><a  href="/join_us.html">加入我们</a></li>
</ul>
</li>
</ul>

                </div>
                <div id="footer_bottom">
                    <ul>
<li><a target="_blank" href="https://www.sipeed.com">©2018-2021 深圳矽速科技有限公司</a></li>
<li><a target="_blank" href="https://beian.miit.gov.cn/#/Integrated/index">粤ICP备19015433号-1</a></li>
</ul>

                </div>
            </div>
                    </div>
</body>
<script src="/static/js/theme_default/tocbot.min.js"></script>
<script src="/static/js/theme_default/main.js"></script>
<script src="/static/css/theme_default/prism.min.js"></script>
<script src="/static/js/custom.js"></script>
<script src="/static/js/search/search_main.js"></script>
<script type="text/javascript" src="/static/js/live.js"></script>
</html>
