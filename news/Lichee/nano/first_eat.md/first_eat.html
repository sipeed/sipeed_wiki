<!DOCTYPE html>

<html lang="zh"  class="">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="keywords" content="Lichee, nano, f1c, linux, 编译, kernel, uboot, buildboot">
    
    
    <meta name="description" content="Licheepi nano 全流程">
    
    <meta name="generator" content="teedoc">
    <meta name="theme" content="teedoc-plugin-theme-default">
    
        
        <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        
        <script>
MathJax = {"loader": {"load": ["output/svg"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}, "svg": {"fontCache": "global"}};
</script>
        
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <meta name="html-generator" content="teedoc-plugin-jupyter-notebook-parser">
        
        <meta name="blog-generator" content="teedoc-plugin-blog">
        
        <script src="/static/js/theme_default/pre_main.js"></script>
        
        <link rel="stylesheet" href="/static/css/theme_default/viewer.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/prism.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/dark.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/light.css" type="text/css"/>
        
        <script src="/static/js/theme_default/jquery.min.js"></script>
        
        <script src="/static/js/theme_default/split.js"></script>
        
        <link rel="stylesheet" href="/static/css/search/style.css" type="text/css"/>
        
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?9cb07365544a53067c56c346c838181a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
        
            <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119047820-5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
  
      gtag('config', 'UA-119047820-5');
    </script>
        
        <link rel="stylesheet" href="/static/css/gitalk/gitalk.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/gitalk/custom_gitalk.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/custom.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/js/thumbs_up/style.css" type="text/css"/>
        
    
    
    <title>Licheepi Nano 使用 TF 卡运行 linux - Sipeed Wiki</title>
    
    <script type="text/javascript">js_vars = {"teedoc-plugin-ad-hint": {"type": "hint", "label": "NEW", "content": "全新 Maix 系列产品 <a href='https://wiki.sipeed.com/maixcam'>MaixCAM</a> 已上线, 全新 <a href='https://wiki.sipeed.com/maixpy/'>MaixPy</a> 功能更丰富，性能更强大，软件更易用，文档更全面！", "show_times": 2, "show_after_s": 432000, "date": "2022-06-01 14:00", "color": "#a0421d", "link_color": "#e53935", "link_bg_color": "#e6ae5c", "bg_color": "#ffcf89", "color_hover": "white", "bg_color_hover": "#f57c00", "close_color": "#eab971"}, "teedoc-plugin-thumbs-up": {"label_up": "有帮助", "label_down": "待改进", "icon": "/static/images/thumbs_up/up.svg", "icon_clicked": "/static/images/thumbs_up/upped.svg", "url": "https://thumbs-up.sipeed.com", "show_up_count": true, "show_down_count": false, "msg_already_voted": "您已经投过票了", "msg_thanks": "感谢您的反馈", "msg_down_prompt": "感谢反馈，请告诉我们可以改进什么地方?（最少 10 个字）", "msg_down_prompt_error": "消息最少需要 10 个字， 最多 256 个字", "msg_error": "请求服务器出现错误!"}}</script>
    <script type="text/javascript">metadata = {"tags": ["linux", "f1c", "compile"], "date": "2022-12-06", "update": [], "ts": 1670284800, "author": "", "brief": "", "cover": ""}</script>
</head>


<body class="type_doc">
    
    <div id="navbar">
        <div id="navbar_menu">
            <a class="site_title" href="/">
                
                    <img class="site_logo" src="/static/image/logo.svg" alt="sipeed wiki logo">
                
                
                    <h2>wiki</h2>
                
        </a>
            <a id="navbar_menu_btn"></a>
        </div>
        <div id="navbar_items">
            <div>
                <ul id="nav_left">
<li class=""><a  href="/">产品</a></li>
<li class="sub_items "><a >开源软件</a><ul><li class=""><a  href="/maixpy/">MaixPy</a></li>
<li class=""><a  href="/soft/maixpy/zh/index.html">MaixPy_v1</a></li>
<li class=""><a  href="/soft/Lichee/zh/index.html">Lichee</a></li>
<li class=""><a  href="/ai/zh/index.html">AI 指南</a></li>
</ul>
</li>
<li class=""><a target="_blank" href="https://maixhub.com">MaixHub</a></li>
<li class="active"><a  href="/news/">动态</a></li>
<li class=""><a  href="/faq.html">FAQ 汇总</a></li>
</ul>

            </div>
            <div>
                <ul id="nav_right">
<li class=""><a  href="/store.html"><img src='/static/image/shop.svg' style='height: 1.5em;vertical-align: middle;'></a></li>
<li class=""><a target="_blank" href="https://github.com/sipeed"><img src='/static/image/github.svg' style='height: 1.5em;vertical-align: middle;'></a></li>
</ul>

                <ul class="nav_plugins"><li><a id="google_translate_element"><img class="icon" src="/static/image/google_translate/translate.svg"/>Translate</a></li></ul><ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">搜索</span>
                            <div id="search_hints">
                                <span id="search_input_hint">输入关键词，多关键词空格隔开</span>
                                <span id="search_loading_hint">正在加载，请稍候。。。</span>
                                <span id="search_download_err_hint">下载文件失败，请刷新重试或检查网络</span>
                                <span id="search_other_docs_result_hint">来自其它文档的结果</span>
                                <span id="search_curr_doc_result_hint">当前文档搜索结果</span>
                            </div></a></li></ul>
            </div>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="sidebar_wrapper">
            <div id="sidebar">
                <div id="sidebar_title">
                    
                </div>
                <ul class="">
</ul>

            </div>
        </div>
        <div id="article">
            <div id="menu_wrapper">
                <div id="menu">
                </div>
            </div>
            <div id="content_wrapper">
                <div id="content_body">
                    <div id="article_head">
                        <div id="article_title">
                            
                            <h1>Licheepi Nano 使用 TF 卡运行 linux</h1>
                            
                        </div>
                        <div id="article_tags">
                            <ul>
                            
                                <li>linux</li>
                            
                                <li>f1c</li>
                            
                                <li>compile</li>
                            
                            </ul>
                        </div>
                        <div id="article_info">
                        <div id="article_info_left">
                            <span class="article_author">
                                
                            </span>
                            
                                <span class="article_date" title="最后修改日期： 2022-12-06">
                                    2022-12-06
                                </span>
                            
                        </div>
                        <div id="article_info_right">
                            
                            <div id="source_link">
                                <a href="https://github.com/sipeed/sipeed_wiki/blob/main/news/Lichee/nano/first_eat.md/first_eat.md" target="_blank">
                                    <span id='editPage'>编辑本页</span>
                                </a>
                            </div>
                            
                        </div>
                        </div>
                    </div>
                    <div id="article_tools">
                        <span></span>
                        <span id="toc_btn"></span>
                    </div>
                    <div id="update_history">
                        
                    </div>
                    <div id="article_content">
                        
                            <span id="blog_start"></span><p>原文链接：<a href="https://codinglover.top/2022/03/25/%E5%B5%8C%E5%85%A5%E5%BC%8Flinux%E5%85%A5%E9%97%A84-1-%E8%8D%94%E6%9E%9D%E6%B4%BEnano%E4%BD%BF%E7%94%A8tf%E5%8D%A1%E8%BF%90%E8%A1%8Clinux/"  target="_blank">嵌入式 linux 入门 4-1-荔枝派 nano 使用 TF 卡运行 linux</a> 有改动</p>
<!-- more -->
<h2 id="%5B%E7%AE%80%E6%98%93%5D%E4%BD%BF%E7%94%A8%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E5%88%B0-TF-%E5%8D%A1">[简易]使用一键脚本构建系统到 TF 卡</h2>
<ol>
<li><p>去如下位置下载 Lichee Nano 文件夹的所有内容：<a href="https://pan.baidu.com/s/1smzuGS9"  target="_blank">https://pan.baidu.com/s/1smzuGS9</a></p>
</li>
<li><p>进入 Lichee Nano/镜像/寻找自己需要的固件，我这里用的 Nano_pub_V4.zip</p>
</li>
<li><p>解压，进入其下的 image 文件找自己需要的镜像，我这里使用 Nano_tf_800480.dd</p>
</li>
<li><p>插上 TF 卡，使用 dd 命令将镜像复制到 TF 卡（windows 用户使用 balenaEtcher 软件烧录）</p>
</li>
</ol>

<pre class="language-bash"><code class="language-bash">sudo dd of=tf卡路径 if=镜像文件路径
</code></pre>
<p>完成，如果只是为了简单使用，那下面的流程不用看了，用这种方法有个问题，那就是根目录的可用空间只有不到 200M，并不能使用 TF 卡的所有空间，不过对于简单应用也足够了。具体解决方法可以前往 <a href="https://github.com/sipeed/Nano-Doc-Backup/blob/master/build_sys/onekey.md#%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BD%BF%E7%94%A8"  target="_blank">github</a> 查看。</p>
<h2 id="%5B%E5%A4%8D%E6%9D%82%5D%E6%89%8B%E5%8A%A8%E6%9E%84%E5%BB%BA%E8%8D%94%E6%9E%9D%E6%B4%BE-TF-%E5%8D%A1%E5%86%85%E7%9A%84%E7%B3%BB%E7%BB%9F">[复杂]手动构建荔枝派 TF 卡内的系统</h2>
<p>本次编译用的宿主机为 ubuntu20.04</p>
<h3 id="%E5%AE%89%E8%A3%85%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E9%93%BE">安装交叉编译链</h3>
<p># 此处为获取 7.2.1 版本，您可获取其他版本或者通过链接直接下载</p>

<pre class="language-bash"><code class="language-bash">wget http://releases.linaro.org/components/toolchain/binaries/7.2-2017.11/arm-linux-gnueabi/gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabi.tar.xz
tar -vxJf gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabi.tar.xz
sudo cp -r ./gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabi /opt/
sudo vi /etc/bash.bashrc


# 在文件末尾 添加以下内容

PATH=&quot;$PATH:/opt/gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabi/bin&quot;

# 添加完毕

# 使路径生效

source /etc/bash.bashrc

#查询版本进行测试，如果成功会打印版本信息
arm-linux-gnueabi-gcc -v
</code></pre>
<h3 id="%E8%8E%B7%E5%8F%96%E5%B9%B6%E7%BC%96%E8%AF%91-u-boot">获取并编译 u-boot</h3>
<ol>
<li>获取 u-boot</li>
</ol>

<pre class="language-bash"><code class="language-bash">sudo apt-get install git
git clone https://github.com/Lichee-Pi/u-boot.git
cd u-boot

# 查看分支

git branch -a

# 切换到 Nano 分支

git checkout nano-v2018.01
</code></pre>
<ol start="2">
<li>编译 u-boot</li>
</ol>

<pre class="language-bash"><code class="language-bash"># 此处告知 make 采用 arm-linux-gnueabi 下的所有交叉编译工具，目标架构为 Arm，设定各项默认配置为 nano 的 spiflash 支持版

make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- licheepi_nano_spiflash_defconfig

# 若不带 spi-flash 的板子，请换成 licheepi_nano_defconfig

# 进行可视化配置，我没有配置，直接按默认就行了

make ARCH=arm menuconfig

# 开始编译

make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- -j8
</code></pre>
<p>编译完成后在 u-boot 目录下找到 u-boot-sunxi-with-spl.bin 文件即为可烧录的文件</p>
<p>附一些错误的解决办法（都是本次遇到的）</p>

<pre class="language-bash"><code class="language-bash"># 如果在可视化配置时提示 : fatal error: curses.h: No such file or directory，进行如下一步来安装支持环境

sudo apt-get install libncurses5-dev libncursesw5-dev

# 如果在编译时提示/bin/sh: 1: python: not found，安装 python 即可

sudo apt-get install python

# 如果编译时提示 unable to execute 'swig': No such file or directory，安装 swig 即可

sudo apt-get install swig

# 如果编译时提示 fatal error: Python.h: No such file or directory，安装 python-dev

sudo apt-get install python-dev
</code></pre>
<h3 id="%E7%83%A7%E5%BD%95-u-boot">烧录 u-boot</h3>
<p>荔枝派 nano 使用的是全志的 F1C100s，官方提供了烧录工具 sunxi-tools，用来对处于 fel 模式下的芯片进行程序烧录。</p>
<p>首先需要获取并编译安装烧录工具:</p>

<pre class="language-bash"><code class="language-bash"># 如果提示缺少 libusb.h，要先安装 libusb 库

sudo apt-get install libusb-1.0-0-dev

# 如果提示缺少 zlib.h，要先安装 libusb 库

sudo apt-get install zlib1g-dev libssl-dev

# 获取并编译安装 sunxi-tools

git clone -b f1c100s-spiflash https://github.com/Icenowy/sunxi-tools.git
cd sunxi-tools
make &amp;&amp; sudo make install
</code></pre>
<p>拉低板子上 spi1 外设的 cs 引脚之后连接 usb 以进入 fel 模式，此时执行以下流程烧录 u-boot：</p>

<pre class="language-bash"><code class="language-bash"># 2.烧进 spi-flash （开机自启）

sudo sunxi-fel -p spiflash-write 0 u-boot-sunxi-with-spl.bin 所在路径
</code></pre>
<p>烧录成功后，通过核心板的 U0RX 和 U0TX 串口引脚来连接串口调试期进行 u-boot 命令行交互，默认的波特率为 115200。</p>
<h3 id="%E6%9E%84%E5%BB%BA-TF-%E5%8D%A1%E7%B3%BB%E7%BB%9F%E5%88%86%E5%8C%BA">构建 TF 卡系统分区</h3>
<p><strong>需要在 TF 卡上构建两个分区</strong></p>
<p>分区 1 用于存放系统启动和内核相关文件，格式化为 FAT，一般只需要分配 32MiB 空间</p>
<ul>
<li>boot.scr (指引 u-boot 加载内核的文件)</li>
<li>zImage (系统内核)</li>
<li>suniv-f1c100s-licheepi-nano.dtb (设备树文件)</li>
</ul>
<p>分区 2 用于存放根文件系统，格式化为 ext4 格式，分配所有剩余的空间</p>
<p><strong>使用 fdisk 工具进行格式化</strong></p>

<pre class="language-bash"><code class="language-bash">sudo fdisk -l # 首先查看电脑上已插入的 TF 卡的设备号
sudo umount /dev/sdXx # 若自动挂载了 TF 设备，请先卸载
sudo fdisk /dev/sdX # 进行分区操作

# 若已存分区即按 d 删除各个分区

# 通过 n 新建分区，第一分区暂且申请为 32M(足够大了...)，剩下的空间都给第二分区

# w 保存写入并退出

sudo mkfs.vfat /dev/sdX1 # 将第一分区格式化成 FAT
sudo mkfs.ext4 /dev/sdX2 # 将第一分区格式化成 EXT4
</code></pre>
<p>使用 parted 命令查看格式化后的结果</p>

<pre class="language-bash"><code class="language-bash">sudo parted -l
</code></pre>
<p><img src="./assets/sdcard_partition.jpg" alt="sdcard_partition" /></p>
<h3 id="%E9%85%8D%E7%BD%AE-u-boot-%E7%9A%84%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC">配置 u-boot 的启动脚本</h3>
<p>提前打开 nano 板子 u-boot 的输出命令行对应的串口，在板子上电时按 enter 键进入 u-boot 命令行，然后输入<strong>printenv</strong>指令查看环境变量信息，我显示的信息如下，#号后是我添加的对关键信息的说明：</p>

<pre class="language-bash"><code class="language-bash">arch=arm                              # 板子的架构
baudrate=115200                       # 命令行串口波特率
board=sunxi
board_name=sunxi
#略去中间大段信息
boot_scripts=boot.scr.uimg boot.scr   # 启动时寻找名为boot.scr.uimg或boot.scr的启动脚本
boot_targets=fel mmc0 usb0 pxe dhcp   # 启动介质的优先级优先从排在前面的介质引导系统
bootcmd=run distro_bootcmd            # 启动时要执行的指令？唔。。。不太明白
#略去后面信息
</code></pre>
<p>根据 boot_scripts 变量我们知道我们要编写一个名为 boot.scr 的启动脚本，然后将这个脚本放到 TF 卡的第一个分区（FAT 分区），u-boot 启动时就会去找这个脚本执行了。</p>
<p>还记得我们编译 u-boot 时获取的 u-boot 源码吗，在其下的 tools 目录中有一个 mkimage 工具可以用于生成 boot.scr，为了生成 boot.scr，首先需要编写 boot.cmd 脚本用来指导 mkimage 进行生成，脚本内容如下：</p>

<pre class="language-bash"><code class="language-bash">setenv bootargs console=tty0 console=ttyS0,115200 panic=5 rootwait root=/dev/mmcblk0p2 rw
load mmc 0:1 0x80C00000 suniv-f1c100s-licheepi-nano.dtb
load mmc 0:1 0x80008000 zImage
bootz 0x80008000 - 0x80C00000
</code></pre>
<ul>
<li><p>第一行 setenv 命令，设定了变量 bootargs(启动参数)为：通过 tty0 和 ttyS0 串口输出启动信息；启动失败延迟 5 秒重启，根文件在 TF 卡的第二分区，可读写；</p>
</li>
<li><p>第二行指定了从 TF 中将设备树的 dtb 文件加载到 0x80C00000 的位置(地址参考自官方 SDK)</p>
</li>
<li><p>第三行指定了将压缩后的内核 zImage 加载到 0x80008000 的位置</p>
</li>
<li><p>第四行为从加载地址启动内核的命令</p>
</li>
</ul>
<p>然后就可以生成 boot.scr 文件了，进入 mkimage 所在目录，然后执行如下指令：</p>

<pre class="language-bash"><code class="language-bash">mkimage -C none -A arm -T script -d
</code></pre>
<p>结果如下：</p>
<p><img src="./assets/set_boot_configurations.png" alt="set_boot_configurations" /></p>
<p>将生成的 boot.scr 拷贝到 TF 卡的 FAT 分区中即可。</p>
<h3 id="%E7%BC%96%E8%AF%91-Linux-%E5%86%85%E6%A0%B8">编译 Linux 内核</h3>
<ol>
<li><p>下载 Linux 源码</p>
<p>完整的下载命令为：</p>

<pre class="language-bash"><code class="language-bash">git clone https://github.com/Icenowy/linux.git
</code></pre>
<p>git 拉取有时速度很慢，建议做如下配置：</p>

<pre class="language-bash"><code class="language-bash">sudo vim /etc/hosts
# 添加下面两行
192.30.253.112  github.com
151.101.73.194 github.global.ssl.fastly.net
# 添加完成
# 可自行通过dns检测网站检测github.global.ssl.fastly.net，更换为更快的ip地址
</code></pre>
<p>完整拉取 linux 极大，建议只拉取单层分支，减少等待时间：</p>

<pre class="language-bash"><code class="language-bash">git clone --depth=1 -b f1c100s-480272lcd-test https://github.com/Icenowy/linux.git
</code></pre>
<p>这里只拉取了单层分支</p>
</li>
<li><p>配置源码</p>

<pre class="language-bash"><code class="language-bash">wget dl.sipeed.com/LICHEE/Nano/SDK/config # 下载配置文件
mv config /linux源码目录/.config           # 移动到linux源码主目录并重命名为.config

# 也可以使用以下指令进行进一步的配置
make ARCH=arm menuconfig
</code></pre>
</li>
<li><p>编译源码</p>
<p>进入 linux 源码主目录后，进行如下操作</p>

<pre class="language-bash"><code class="language-bash">#配置架构，然后使用可视化配置工具对源码进行配置
make ARCH=arm menuconfig # 这里可以直接退出配置界面，我们用默认配置就行了

#配置编译用的工具链前缀
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- -j4 #请自行修改编译线程数
</code></pre>
</li>
<li><p>编译过程中碰到的问题记录</p>
<ol>
<li><p>编译过程中提示是否需要使能某些配置<br />
这是因为配置文件中没有对应的配置项，根据情况选择，我一律选择了 n，不需要它们。</p>
</li>
<li><p>提示 fatal error: openssl/bio.h: No such file or directory</p>

<pre class="language-bash"><code class="language-bash">sudo apt install libssl-dev # 缺少这个库
</code></pre>
</li>
</ol>
</li>
</ol>
<p>编译要挺长的时间，这取决于机器性能。编译成功后，显示如下信息：</p>
<p><img src="./assets/compile_kernel.png" alt="compile_kernel" /></p>
<p>这时到 linux 源码目录下的 arch/arm/boot/目录中可以找到内核镜像 zImage，将其拷贝到 TF 卡的 FAT 第一分区。</p>
<h3 id="%E9%85%8D%E7%BD%AE%E8%AE%BE%E5%A4%87%E6%A0%91">配置设备树</h3>
<p><a href="https://wiki.sipeed.com/soft/Lichee/zh/Nano-Doc-Backup/build_sys/devicetree.html"  target="_blank">设备树添加节点</a>这一章节有详细介绍，有需要的可以自行查看。由于本次只使用核心板，所以不用配置 dts 文件，直接编译生成 dtb 就行了。</p>
<p>荔枝派 Nano 对应的 dts 文件为 Linux 源码主目录下的 arch/arm/boot/dts/suniv-f1c100s-licheepi-nano.dts</p>
<p>进入 Linux 源码的主目录，之后执行以下指令编译 dtb 文件：</p>

<pre class="language-bash"><code class="language-bash">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- dtbs -j4
</code></pre>
<p>编译成功后，在 Linux 源码的主目录的 arch/arm/boot/dts/下可以找到 suniv-f1c100s-licheepi-nano.dtb 文件（这个文件的文件名和前面生成 boot.scr 时在 boot.cmd 中设置的文件名一致），将其复制到 TF 卡的 FAT 第一分区。</p>
<h3 id="%E6%9E%84%E5%BB%BA%E6%A0%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">构建根文件系统</h3>
<p>使用 buildroot 构建根文件系统，流程如下：</p>
<ol>
<li>下载安装</li>
</ol>

<pre class="language-bash"><code class="language-bash"># 获取所需的头文件
sudo apt install linux-headers-$(uname -r) #uname -r用于获取内核版本号

# 下载、解压、进入目录（这个国外链接下载有点慢）
wget https://buildroot.org/downloads/buildroot-2017.08.tar.gz
tar xvf buildroot-2017.08.tar.gz
cd buildroot-2017.08/
</code></pre>
<ol start="2">
<li>配置 buildroot 工具</li>
</ol>

<pre class="language-bash"><code class="language-bash"># 进入配置界面
make menuconfig

以下选项为基础配置：

- Target options
 - Target Architecture (ARM (little endian))
 - Target Variant arm926t
- Toolchain
 - C library (musl) # 使用musl减小最终体积
- System configuration
 - Use syslinks to /usr .... # 启用/bin, /sbin, /lib的链接
 - Enable root login # 启用root登录
 - Run a getty after boot # 启用登录密码输入窗口
 - (licheepi) Root password #　默认账户为root 密码为licheepi
另可自行添加或删除指定的软件包
</code></pre>
<ol start="3">
<li>编译</li>
</ol>

<pre class="language-bash"><code class="language-bash">make
</code></pre>
<p>由于编译过程中需要下载软件包以及不支持多线程编译，编译需要很长时间（晚上丢那编译，一觉醒来就好了），编译完成后的文件为 buildroot 目录下的 output/images/rootfs.tar</p>
<ul>
<li><p>tips：</p>
<p>若编译时，buildroot 下载软件包速度太慢，请下载 dl.zip ，将其中的软件包解压至 buildroot 的 dl 下目录（官方文档的解决方法）；</p>
<p>或者也可以考虑使用 vi 打开 buildroot 的.config 文件，将其中的对应配置切换为以下内容以切换到国内镜像站进行下载（个人推荐此方法）：</p>

<pre class="language-none"><code class="language-none">BR2_BACKUP_SITE=&quot;http://sources.buildroot.net&quot;
BR2_KERNEL_MIRROR=&quot;https://mirror.bjtu.edu.cn/kernel/&quot;
BR2_GNU_MIRROR=&quot;http://mirrors.nju.edu.cn/gnu/&quot;
BR2_LUAROCKS_MIRROR=&quot;https://luarocks.cn&quot;
BR2_CPAN_MIRROR=&quot;http://mirrors.nju.edu.cn/CPAN/&quot;
</code></pre>
</li>
</ul>
<ol start="4">
<li><p>编译过程中的问题解决记录</p>
<ol>
<li>error &quot;Please port gnulib freadahead.c to your platform!类似的错误</li>
</ol>

<pre class="language-bash"><code class="language-bash"># 进入buildroot下的如下目录
cd output/build/host-m4-1.4.18/

# 执行如下指令（查了半天，没搞懂是干嘛的）
sed -i 's/IO_ftrylockfile/IO_EOF_SEEN/' lib/*.c

# 在lib/stdio-impl.h文件最后新增一行#define _IO_IN_BACKUP 0x100
echo &quot;#define _IO_IN_BACKUP 0x100&quot; &gt;&gt; lib/stdio-impl.h

# 之后返回buildroot主目录执行make继续编译

# stackoverflow上一位老哥说了出现这个问题的原因，不知道是不是对的
# This was an interoperability problem between GNU m4 1.4.18 and
# newer glibc header files.
# It is fixed in GNU m4 1.4.19, available from
# https://ftp.gnu.org/gnu/m4/ and the GNU mirrors.
</code></pre>
</li>
</ol>
<p>编译完成后，文件为 buildroot 下的 output/images/rootfs.tar，将其复制到 TF 卡的 ext4 第二分区并解压。</p>
<h3 id="%E9%AA%8C%E8%AF%81">验证</h3>
<p>将 TF 卡插入荔枝派 nano，使用 USB 转 TTL 模块连接荔枝派的 U0TX 和 U0RX 这对串口，应该就正常上电进入登录界面了。</p>
<p><img src="./assets/boot_licheepi_nano.jpg" alt="boot_licheepi_nano" /></p>
<p>使用用户名 root，密码 licheepi 进行登录即可。</p>
<p>使用 fdisk 指令，根文件系统已经可以识别 TF 卡中的所有空闲空间</p>
<p><img src="./assets/licheepi_fdisk.jpg" alt="licheepi_fdisk" /></p>

                        
                    </div>
                </div>
                <div id="previous_next">
                    <div id="previous">
                        
                    </div>
                    <div id="next">
                        
                    </div>
                </div>
                <div id="comments-container"></div>
            </div>
            <div id="toc_wrapper">
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="to_top" href="#"></a>
    <div id="doc_footer">
        <div id="footer">
            <div id="footer_top">
                <ul>
<li><a>相关链接</a><ul><li><a target="_blank" href="https://www.sipeed.com">Sipeed 官网</a></li>
<li><a target="_blank" href="https://maixhub.com/">MaixHub</a></li>
<li><a target="_blank" href="https://sipeed.taobao.com/">Sipeed 淘宝</a></li>
<li><a  href="/sitemap.xml">网站地图</a></li>
<li><a target="_blank" href="https://github.com/teedoc/teedoc">网站使用 teedoc 生成</a></li>
</ul>
</li>
<li><a>源码</a><ul><li><a target="_blank" href="https://github.com/sipeed/sipeed_wiki">Wiki 源码</a></li>
<li><a target="_blank" href="https://github.com/sipeed">开源项目</a></li>
</ul>
</li>
<li><a>关注我们</a><ul><li><a target="_blank" href="https://twitter.com/SipeedIO">twitter</a></li>
<li><a target="_blank" href="https://sipeed.taobao.com/">淘宝</a></li>
<li><a target="_blank" href="https://github.com/sipeed">github</a></li>
<li><a><a>微信公众号</a><img src='/static/image/wechat.png'></a>
</li>
</ul>
</li>
<li><a>联系我们</a><ul><li><a>电话: +86 0755-27808509</a>
</li>
<li><a>商业支持: support@sipeed.com</a>
</li>
<li><a>地址: 深圳市宝安区新湖路4008号蘅芳科技办公大厦A座-2101C</a>
</li>
<li><a  href="/join_us.html">加入我们</a></li>
</ul>
</li>
</ul>

            </div>
            <div id="footer_bottom">
                <ul>
<li><a target="_blank" href="https://www.sipeed.com">©2018-2023 深圳矽速科技有限公司</a></li>
<li><a target="_blank" href="https://beian.miit.gov.cn/#/Integrated/index">粤ICP备19015433号</a></li>
</ul>

            </div>
        </div>
    </div>
    
        <script src="/teedoc-plugin-markdown-parser/mermaid.min.js"></script>
    
        <script>mermaid.initialize({startOnLoad:true});</script>
    
        <script type="text/javascript">
                var transLoaded = false;
                var loading = false;
                var domain = "translate.google.com";
                var domainDefault = domain;
                var storeDomain = localStorage.getItem("googleTransDomain");
                if(storeDomain){
                    domain = storeDomain;
                    console.log("load google translate domain from local storage:" + domain);
                }
                function getUrl(domain){
                    if(domain == "/")
                        return "/static/js/google_translate/element.js?cb=googleTranslateElementInit";
                    else
                        return "https://" + domain + "/translate_a/element.js?cb=googleTranslateElementInit";
                }
                var url = getUrl(domain);
                console.log("google translate domain:" + domain + ", url: " + url);
                function googleTranslateElementInit() {
                    new google.translate.TranslateElement({pageLanguage: "auto", layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element');
                }
                function loadJS( url, callback ){
                    var script = document.createElement('script');
                    fn = callback || function(){ };
                    script.type = 'text/javascript';
                    if(script.readyState){
                        script.onreadystatechange = function(){
                            if( script.readyState == 'loaded' || script.readyState == 'complete' ){
                                script.onreadystatechange = null;
                                fn();
                            }
                        };
                    }else{
                        script.onload = function(){
                            fn();
                        };
                    }
                    script.src = url;
                    document.getElementsByTagName('head')[0].appendChild(script);
                }
                function removeHint(){
                    var hint = document.getElementById("loadingTranslate");
                    if(hint){
                        hint.remove();
                    }
                }
                var btn = document.getElementById("google_translate_element");
                btn.onclick = function(){
                    if(transLoaded) return;
                    if(loading){
                        var flag = confirm("loading from " + domain + ", please wait, or change domain?");
                        if(flag){
                            newDomain = prompt("domain, default: " + domainDefault + ", now: " + domain);
                            if(newDomain){
                                domain = newDomain;
                                console.log(domain);
                                url = getUrl(domain);
                                loadJS(url, function(){
                                    localStorage.setItem("googleTransDomain", domain);
                                    removeHint()
                                    transLoaded = true;
                                });
                            }
                        }
                        return;
                    }
                    btn.innerHTML = '<span id="loadingTranslate"><img class="icon" src="/static/image/google_translate/translate.svg"/>Loading ...</span>';
                    loading = true;
                    loadJS(url, function(){
                        localStorage.setItem("googleTransDomain", domain);
                        removeHint()
                        transLoaded = true;
                    });
                }
                </script>
            
    
        <script src="/static/js/plugin_blog/main.js"></script>
    
        <script src="/static/js/theme_default/tocbot.min.js"></script>
    
        <script src="/static/js/theme_default/main.js"></script>
    
        <script src="/static/js/theme_default/viewer.min.js"></script>
    
        <script src="/static/js/prism.js"></script>
    
        <script src="/static/js/search/search_main.js"></script>
    
        <script src="/static/js/gitalk/gitalk.min.js"></script>
    
        <script src="/static/js/gitalk/main.js"></script>
    
        <link rel="stylesheet" href="/static/js/add_hint/style.css" type="text/css"/>
    
        <script src="/static/js/add_hint/main.js"></script>
    
        <script src="/static/js/custom.js"></script>
    
        <script src="/static/js/thumbs_up/main.js"></script>
    
</body>

</html>